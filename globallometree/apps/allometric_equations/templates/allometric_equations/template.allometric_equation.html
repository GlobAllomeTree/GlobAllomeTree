{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Fantallometrik{% endblock %}

{% block script %}	
    <script type='text/javascript' src='https://www.google.com/jsapi'></script>
    <script type='text/javascript'>
        google.load('visualization', '1', {'packages': ['geochart']});
        google.setOnLoadCallback(drawRegionsMap);
    
        function drawRegionsMap() {
            var data = new google.visualization.DataTable();
            data.addRows(1);
            data.addColumn('string', 'Country');
            data.setValue(0, 0, '{{ allometric_equation.Country.iso_3166_1_2_letter_code }}');
        
            var options = { width: '400',backgroundColor : {stroke : '#bbb'}, datalessRegionColor : 'FCFCFC' };
        
            var container = document.getElementById('regions_map_canvas');
            var geochart = new google.visualization.GeoChart(container);
            geochart.draw(data, options);
            window.geochart = geochart;
        }
    </script>
    {% if allometric_equation.Latitude %}
    <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAeYuEKNTghtouEoy-USjrJff3A32F9DP4&sensor=false">
    </script>
    <script type="text/javascript">
        $(function () {
            var map = null;
            //var initialBounds = null;
        	$('#locationTab').click(function () {
                if (map == null) {
                    $('#point_map_canvas_holder').html('');
                    $('#point_map_canvas_holder').html('<div style="width:400px;height:300px;" id="point_map_canvas"></div>');
                    var center =  new google.maps.LatLng({{ allometric_equation.Latitude }}, {{ allometric_equation.Longitude }});
                    var mapOptions = {
                        center: center,
                        zoom: 11,
                        mapTypeId: google.maps.MapTypeId.HYBRID,
                        panControl: true,
                        zoomControl: true,
                        scaleControl: true
                    };
                    map = new google.maps.Map(document.getElementById("point_map_canvas"), mapOptions);
                    var marker = new google.maps.Marker({
                        position: center,
                        map: map
                    });
                } else {
                    //Timeout until the tab appears so the map can be redrawn correctly
                    setTimeout( function () {google.maps.event.trigger(map, 'resize');} , 200); 
                }
            });
        });
    </script>
    {% else %}
    <script type="text/javascript">
        $(function () {
            $("#point_map_canvas").html('Precise location not available');
        });
    </script>
    {% endif %}
    <style>
        #TreeEquation_id table td {
            white-space:wrap;
        }
    </style>
{% endblock %}

{% block content %}


        <div style="float:right;"><a href="pdf"><img src="{% static 'images/pdficon.png' %}" /> Download equation as PDF</a></div>
        <div class="page-header">
            <h2>Equation {{ allometric_equation.ID }}</h2>
        </div>
        

<div class="row">     
    <div class="col-md-7">
        <h3>Allometry</h3>
        <table class="table">
            <tr><td> Equation: </td><td> <code>{{ allometric_equation.Substitute_equation }} </code> </td></tr>
            <tr><td> Sample size: </td><td> {{ allometric_equation.Sample_size }} </td></tr>
            <tr><td> R2: </td><td> {{ allometric_equation.R2|floatformat:"-2" }} </td></tr>
        </table>
    </div>
</div>
<div class="row">     
    <div class="col-md-7">
        <h3>Taxonomy</h3>
        <table class="table">
            <tr><td> Population: </td><td> {{ allometric_equation.population }} </td></tr>
            <tr><td> Family Genus species:<br>
            </td><td> {% for species in allometric_equation.species_group.species_set %} {{species}} <br> {% endfor %}</td></tr>
        </table>
  </div>
</div>
<div class="row">     
    <div class="col-md-7">    
        <h3>Location</h3>
        <div style="float:right;width:400px;">
            <div id="regions_map_canvas"></div>
            <br><br>
            <div id="point_map_canvas_holder"></div>
        </div>
        <table class="table">  
            <tr><td> Ecosystem: </td><td> {{ allometric_equation.ecosystem }} </td></tr>
            <tr><td> Continent: </td><td> {{ allometric_equation.location_group.continents_string }} </td></tr>
            <tr><td> Country: </td><td> {{ allometric_equation.location_group.countries_string }} </td></tr>
            <tr><td> Location Name: </td><td> {{ allometric_equation.location_group.locations_string }} </td></tr>
            <tr><td> Biome FAO: </td><td> {{ allometric_equation.location_group.biomes_fao_string }} </td></tr>
            <tr><td> Biome UDVARDY: </td><td> {{ allometric_equation.location_group.biomes_udvardy_string }} </td></tr>
            <tr><td> Biome WWF: </td><td> {{ allometric_equation.location_group.biomes_wwf_string }} </td></tr>
            <tr><td> Biome HOLDRIDGE: </td><td> {{ allometric_equation.location_group.biomes_holdridge_string }} </td></tr>
            <tr class="odds">  <td> Division BAILEY: </td><td> {{ allometric_equation.location_group.divisions_bailey_string }} </td></tr>
        </table>
  </div>
</div>
<div class="row">    
    <div class="col-md-6">
        <h3>Components</h3>
        <table class="table" style="width:200px">
            <tr>
                <td> Components: </td>
                <td>
                    {{ allometric_equation.components_string }}
                </td>
            </tr>
        </table> 
    </div>
    <div class="col-md-6">
        <br><br>
        <img src="{% static 'images/components.png' %}" width="300" />
   </div>
</div>
<div class="row">     
    <div class="col-md-7">
        <h3>Input/Output</h3>
        <table class="table" style="width:200px">
            <tr><td> X: </td><td> {{ allometric_equation.X }} </td></tr>
            <tr><td> Unit X: </td><td> {{ allometric_equation.Unit_X }} </td></tr>
            <tr><td> Unit Y: </td><td> {{ allometric_equation.Unit_Y }} </td></tr>
            <tr><td> Z: </td><td> {{ allometric_equation.Z }} </td></tr>
            <tr><td> Unit Z: </td><td> {{ allometric_equation.Unit_Z }} </td></tr>
            <tr><td> W: </td><td> {{ allometric_equation.W }} </td></tr>
            <tr><td> Unit_W: </td><td> {{ allometric_equation.Unit_W }} </td></tr>
            <tr><td> U: </td><td> {{ allometric_equation.U }} </td></tr>
            <tr><td> Unit_U: </td><td> {{ allometric_equation.Unit_U }} </td></tr>
            <tr><td> V: </td><td> {{ allometric_equation.V }} </td></tr>
            <tr><td> Unit V: </td><td> {{ allometric_equation.Unit_V }} </td></tr>
            <tr><td> Min X: </td><td> {{ allometric_equation.Min_X|floatformat:"-2" }} </td></tr>
            <tr><td> Max X: </td><td> {{ allometric_equation.Max_X|floatformat:"-2" }} </td></tr>
            <tr><td> Min Z: </td><td> {{ allometric_equation.Min_Z|floatformat:"-2" }} </td></tr>
            <tr><td> Max Z: </td><td> {{ allometric_equation.Max_Z|floatformat:"-2" }} </td></tr>
            <tr><td> Output: </td><td> {{ allometric_equation.Output }} </td></tr>
            <tr><td> Output TR: </td><td> {{ allometric_equation.Output_TR }} </td></tr>
            <tr><td> Age: </td><td> {{ allometric_equation.Age }} </td></tr>
            <tr><td> Veg component: </td><td> {{ allometric_equation.Veg_Component }} </td></tr>
        </table>
    </div>
</div>
<div class="row">     
    <div class="col-md-7">
        <h3>Reference</h3>
        <table class="table">
            <tr><td> Label: </td><td> {{ allometric_equation.reference.label }} </td></tr>
            <tr><td> Author: </td><td> {{ allometric_equation.reference.author }} </td></tr>
            <tr><td> Year: </td><td> {{ allometric_equation.reference.year }} </td></tr>
            <tr><td> Reference: </td><td> {{ allometric_equation.reference.reference }} </td></tr>
        </table>
    </div>
</div>
{% endblock %}